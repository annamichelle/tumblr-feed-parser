<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<title>Feed Parser</title>
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta name="description" content="">
	<meta name="author" content="">

	<!-- Le styles -->
	<link href="http://twitter.github.com/bootstrap/assets/css/bootstrap.css" rel="stylesheet">
	<link href="http://twitter.github.com/bootstrap/assets/css/bootstrap-responsive.css" rel="stylesheet">
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/3.0.2/css/font-awesome.min.css">

	<!-- Le HTML5 shim, for IE6-8 support of HTML5 elements -->
	<!--[if lt IE 9]>
		<script src="//html5shim.googlecode.com/svn/trunk/html5.js"></script>
	<![endif]-->

	<style>

		.post {
			margin-bottom: 20px;
		}

		.post i {
			font-size: 36px;
			float: left;
			display: block;
			width: auto;
		}

		.post .content {
			padding-left: 45px;
		}

		.post-date {
			display: block;
			text-transform: uppercase;
			font-weight: bold;
			font-size: 16px;
			margin-bottom: 15px;
		}

		.post .photo {
			border: 1px #eee solid;
		}

		.bordered {
			border-top: 1px #eee solid;
			padding-top: 40px;
		}

		/* 
		   Responsive youtube videos 
		   source: http://avexdesigns.com/responsive-youtube-embed/ 
		*/

		.video-container {
			position: relative;
			padding-bottom: 56.25%;
			padding-top: 30px; 
			height: 0; 
			overflow: hidden;
		}

		.video-container iframe,
		.video-container object,
		.video-container embed {
			position: absolute;
			top: 0;
			left: 0;
			width: 100%;
			height: 100%;
		}

		/* end */
	</style>
</head>
<body>

	<div class="container">
		<h2>Tumblr Feed</h2>
		<div id="main"></div>
	</div> <!-- /container -->

	<!-- Le javascript
	================================================== -->
	<!-- Placed at the end of the document so the pages load faster -->
	<script src="//code.jquery.com/jquery.min.js"></script>
	<script src="//cdnjs.cloudflare.com/ajax/libs/moment.js/2.0.0/moment.min.js"></script>

	<script>

		var blog_url    = 'http://jeremymouton.tumblr.com';
		var tumblr_feed = blog_url + '/api/read/json?callback=?';

		$.getJSON(tumblr_feed, function(data) {
			getPosts(data.posts);
		});

		// HELPERS
		function getPosts(json) {
			for( var i=0, l=json.length; i<l; i++ ) {
				formatPost(json[i]);
			}
		}

		function formatPost(post) {
			date    = moment(post['date'], 'ddd, D MMM YYYY HH:mm:ss').format('MMMM Do YYYY');
			content = post['regular-body'];
			type    = post.type;

			switch (type)
			{
			// Normal post
			case "regular":
				content = post['regular-body'];
				icon    = 'icon-align-left';
				break;

			// Link post
			case "link":
				content = '<span class="link-text"><a href="' + post['link-url'] + 
				          '" target="_blank">' + post['link-text'] + '</a></span>' +
				          '<span class="link-description"> ' + post['link-description'] + '</span>';
				icon    = 'icon-link';
				break;

			// Video post
			case "video":
				content = '<div class="video-container">' + post['video-player-500'] + '</div><span class="video-caption">' + post['video-caption'] + '</span>';
				icon    = 'icon-film';
				break;

			// Photo post
			case "photo":
				content = '<div class="photo"><img src="' + post['photo-url-1280'] + 
				          '" alt="' + post['photo-caption'] + '"></div>' +
				          '<span class="photo-caption">' + post['photo-caption'] + '</span>';
				icon    = 'icon-picture';
				break;

			case "quote":
				content = '<blockquote>' + post['quote-text'] + '</blockquote>';
				icon    = 'icon-quote-right';
				break;
			}

			// Send it to the view
			$('#main').append('<div class="post"><span class="post-date">' + date + '</span><i class="' + icon + '"></i><div class="content">' + content + '</div></div>');


			// Remove duplicate dates
			// http://stackoverflow.com/a/2822974
			var seen = {};
			$('.post-date').each(function() {
				var txt = $(this).text();
				if (seen[txt])
					$(this).hide().next('content').addClass('bordered');
				else
					seen[txt] = true;
			});
		}

	</script>
</body>
</html>